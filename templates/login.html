{% extends "base.html" %}
{% block content %}
<section class="auth">
  <div class="auth-wrap">
    <h2>Entrar</h2>
    <input id="email" placeholder="Email" />
    <input id="senha" type="password" placeholder="Senha" />
    <button id="btn-login">Entrar</button>
    <p>Ou</p>
    <h3>Cadastrar</h3>
    <input id="nome-cad" placeholder="Nome" />
    <input id="email-cad" placeholder="Email" />
    <input id="senha-cad" type="password" placeholder="Senha" />
    <button id="btn-cad">Cadastrar</button>
  </div>
</section>

<script>
document.getElementById('btn-login').onclick = async ()=>{
  const email = document.getElementById('email').value;
  const senha = document.getElementById('senha').value;
  const res = await fetch('/api/login',{method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({email, senha})});
  const j = await res.json();
  if(res.ok){
    localStorage.setItem('token', j.token);
    localStorage.setItem('user', JSON.stringify(j.user));
    alert('Login efetuado!');
    window.location = '/perfil';
  } else {
    alert(j.message || JSON.stringify(j));
  }
};

document.getElementById('btn-cad').onclick = async ()=>{
  const nome = document.getElementById('nome-cad').value;
  const email = document.getElementById('email-cad').value;
  const senha = document.getElementById('senha-cad').value;
  const res = await fetch('/api/register',{method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({nome, email, senha})});
  const j = await res.json();
  if(res.ok){
    alert('Cadastro efetuado! Agora fa√ßa login.');
  } else {
    alert(j.message || JSON.stringify(j));
  }
};
</script>
{% endblock %}
