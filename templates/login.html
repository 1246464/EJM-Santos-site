{% extends "base.html" %}
{% block content %}
<section class="auth">
  <div class="auth-wrap">
    <h2>Entrar</h2>

    {% if erro %}
      <div class="erro-msg">{{ erro }}</div>
    {% endif %}

    <!-- FORMULÁRIO DE LOGIN VIA FLASK -->
    <form action="/login" method="POST" id="form-login">
      <input name="email" id="email" placeholder="Email" required />
      <input name="senha" id="senha" type="password" placeholder="Senha" required />
      <button type="submit" id="btn-login">Entrar</button>
    </form>

    <p>Ou</p>

    <h3>Cadastrar</h3>
    <input id="nome-cad" placeholder="Nome" />
    <input id="email-cad" placeholder="Email" />
    <input id="senha-cad" type="password" placeholder="Senha" />
    <button id="btn-cad">Cadastrar</button>

    <div id="msg" class="msg"></div>
  </div>
</section>

<script>
  // CADASTRO PELO /api/register
  document.getElementById('btn-cad').onclick = async () => {
    const nome = document.getElementById('nome-cad').value.trim();
    const email = document.getElementById('email-cad').value.trim();
    const senha = document.getElementById('senha-cad').value.trim();
    const msg = document.getElementById('msg');

    if (!nome || !email || !senha) {
      msg.textContent = 'Preencha todos os campos para cadastrar.';
      msg.style.color = 'red';
      return;
    }

    const res = await fetch('/api/register', {
      method: 'POST',
      headers: {'Content-Type': 'application/json'},
      body: JSON.stringify({ nome, email, senha })
    });

    const j = await res.json();
    if (res.ok) {
      msg.textContent = '✅ Cadastro realizado com sucesso! Agora faça login.';
      msg.style.color = 'green';
    } else {
      msg.textContent = j.message || 'Erro ao cadastrar.';
      msg.style.color = 'red';
    }
  };
</script>
{% endblock %}
