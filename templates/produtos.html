{% extends "base.html" %}
{% block content %}
<section class="produtos">
  <h2>Produtos</h2>
  <div id="produtos-grid" class="produtos-grid"></div>
</section>
<script>
function renderDesktop(p, card) {
  card.innerHTML = `
    <img src="/static/imagens/${p.imagem}" alt="${p.titulo}">
    <h3>${p.titulo}</h3>
    <p>${p.descricao}</p>
    <span class="preco">R$ ${p.preco.toFixed(2)}</span>
    
    <div class="produto-actions">
      <a class="botao-comprar" href="/produto/${p.id}">Detalhes</a>
      <a class="botao-comprar" href="${p.mercado_pago_link || '#'}" target="_blank">Comprar</a>
    </div>

    <div class="meta">Avaliação: ${p.media || 0} ⭐ (${p.n_reviews})</div>
  `;
}


function renderMobile(p, card) {
  card.innerHTML = `
    <a href="/produto/${p.id}" class="card-link">
      <img src="/static/imagens/${p.imagem}" alt="${p.titulo}">
      <h3>${p.titulo}</h3>
      <span class="preco">R$ ${p.preco.toFixed(2)}</span>
    </a>
  `;
}

fetch('/api/products')
  .then(r => r.json())
  .then(data => {
    const grid = document.getElementById('produtos-grid');
    grid.innerHTML = '';

    const isMobile = window.innerWidth <= 768;

    data.forEach(p => {
      const card = document.createElement('div');
      card.className = 'card';

      if (isMobile) {
        renderMobile(p, card);
      } else {
        renderDesktop(p, card);
      }

      grid.appendChild(card);
    });
  });

async function addToCart(id) {
  const response = await fetch('/carrinho/add/' + id, { method: 'POST' });
  if (response.ok) {
    alert('✅ Produto adicionado ao carrinho!');
  } else {
    alert('❌ Erro ao adicionar ao carrinho!');
  }
}

</script>
{% endblock %}