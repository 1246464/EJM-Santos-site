{% extends "base.html" %}
{% block content %}
<section class="hero">
  <div class="hero-left">
    <h1>Mel puro, direto da colmeia</h1>
    <p>Produzido com cuidado, sem conservantes ‚Äî perfeito para seu dia a dia.</p>
    <a class="botao-topo" href="/produtos">Ver Produtos</a>
  </div>
  <div class="hero-right">
    <img src="{{ url_for('static', filename='imagens/1760708557479.jpg') }}" alt="colmeia">
  </div>
</section>

<section class="intro">
  <h2>Por que nosso mel √© especial?</h2>
  <div class="qualidades">
    <div><span>üçÉ</span> Natural</div>
    <div><span>üçØ</span> Puro</div>
    <div><span>üö´</span> Sem conservantes</div>
  </div>
</section>

<section id="produtos" class="produtos-preview">
  <h2>Nossos Produtos</h2>
  <div id="produtos-list"></div>
</section>
<script>
  // carrega produtos principais via API
  fetch('/api/products').then(r=>r.json()).then(data=>{
    const wrap = document.getElementById('produtos-list');
    data.slice(0,4).forEach(p=>{
      const card = document.createElement('div');
      card.className = 'card';
      const esgotado = p.estoque <= 0;
      
      // Tornar card clic√°vel
      card.style.cursor = 'pointer';
      card.onclick = (e) => {
        // Evitar navega√ß√£o se clicar nos bot√µes
        if (!e.target.classList.contains('botao-comprar')) {
          window.location.href = `/produto/${p.id}`;
        }
      };
      
      const imagePath = p.imagem.startsWith('imagens/') ? p.imagem.substring(8) : p.imagem;
      card.innerHTML = `
        <img src="/static/imagens/${imagePath}" alt="${p.titulo}">
        <h3>${p.titulo}</h3>
        <p class="desc">${p.descricao}</p>
        <span class="preco">R$ ${p.preco.toFixed(2)}</span>
        <div class="produto-actions">
          ${esgotado ? '<button class="botao-comprar" style="opacity:0.5" disabled>Esgotado</button>' :
            `<button class="botao-comprar" onclick="event.stopPropagation(); addToCart(${p.id})">Adicionar</button>`}
          <a class="botao-comprar" href="/produto/${p.id}" onclick="event.stopPropagation()">Detalhes</a>
        </div>
      `;
      wrap.appendChild(card);
    });
  }).catch(err => console.error('Erro ao carregar produtos:', err));
  
  async function addToCart(id) {
    const response = await fetch('/carrinho/add/' + id, { method: 'POST' });
    if (response.ok) {
      alert('‚úÖ Produto adicionado ao carrinho!');
      location.href = '/carrinho';
    } else {
      const text = await response.text();
      if (text.includes('Esgotado')) {
        alert('‚ùå Produto esgotado!');
      } else if (text.includes('insuficiente')) {
        alert('‚ö†Ô∏è Estoque insuficiente!');
      } else {
        alert('‚ùå Erro ao adicionar produto!');
      }
    }
  }
</script>
{% endblock %}
