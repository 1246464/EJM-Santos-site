{% extends "base.html" %}
{% block content %}
<section class="produto-mobile">

  <div class="produto-imagem">
    <img id="imagem-produto" src="" alt="Produto">
  </div>

  <div class="produto-conteudo">
    <h1 id="titulo-produto"></h1>
    <div class="produto-preco" id="preco-produto"></div>
    <p class="produto-vendas">+10 vendidos</p>

    <button id="btn-add-cart" class="btn-carrinho-mobile">
      üõí Adicionar ao Carrinho
    </button>

    <hr>

    <h3>Descri√ß√£o</h3>
    <p id="descricao-produto"></p>

    <div class="btn-ver-avaliacoes" onclick="scrollToReviews()">
      ‚≠ê Ver avalia√ß√µes
    </div>

    <div id="produto-reviews" class="reviews-area"></div>

    <div id="avaliar-area"></div>

  </div>

  <!-- Bot√£o fixo no rodap√© -->
  <div class="footer-compra">
    <a id="btn-finalizar" class="btn-comprar-mobile" href="#">
      Comprar agora
    </a>
  </div>

</section>

<script>
const productId = {{ product_id }};
const token = localStorage.getItem('token');

// Atualiza UI com os dados do produto
function showProduct(p) {
  document.getElementById("imagem-produto").src = "/static/imagens/" + p.imagem;
  document.getElementById("titulo-produto").textContent = p.titulo;
  document.getElementById("preco-produto").textContent = "R$ " + p.preco.toFixed(2);
  document.getElementById("descricao-produto").textContent = p.descricao;
  
  document.getElementById("btn-finalizar").href = p.mercado_pago_link || "#";
  document.getElementById("btn-add-cart").onclick = () => addToCart(p.id);
}

// Rolar at√© avalia√ß√µes
function scrollToReviews() {
  document.getElementById('produto-reviews').scrollIntoView({ behavior: "smooth" });
}


// Carrinho
async function addToCart(id) {
  const response = await fetch('/carrinho/add/' + id, { method: 'POST' });
  if (response.ok) alert('‚úÖ Adicionado ao carrinho!');
}

// Avalia√ß√µes
function showReviews(list) {
  const c = document.getElementById('produto-reviews');
  c.innerHTML = '<h3>Avalia√ß√µes</h3>';
  if (!list || list.length === 0) {
    c.innerHTML += '<p>Nenhuma avalia√ß√£o ainda.</p>';
    return;
  }
  list.forEach(r => {
    const div = document.createElement('div');
    div.className = "comentario";
    div.innerHTML = `<strong>${r.nome}</strong> ‚Ä¢ ${r.nota} ‚≠ê<br><span>${r.comentario}</span>`;
    c.appendChild(div);
  });
}

// Inicializa
fetch(`/api/product/${productId}`)
  .then(r => r.json())
  .then(data => {
    showProduct(data);
    showReviews(data.reviews || []);
  });
</script>
{% endblock %}
