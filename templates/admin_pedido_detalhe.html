{% extends "base.html" %}
{% block content %}

<section class="painel-admin">
  <div class="painel-wrap" style="max-width:1000px;">
    <h2>Pedido #{{ pedido.id }}</h2>
    <p><strong>Cliente:</strong> {{ user.nome if user else ('ID '+pedido.user_id|string) }}</p>
    <p><strong>E-mail:</strong> {{ user.email if user else '-' }}</p>
    <p><strong>Data:</strong> {{ pedido.created_at.strftime('%d/%m/%Y %H:%M') if pedido.created_at }}</p>

    <!-- Endere√ßo de Entrega -->
    {% if pedido.endereco_rua %}
    <div class="endereco-entrega">
      <h3>üìç Endere√ßo de Entrega</h3>
      <p><strong>Rua:</strong> {{ pedido.endereco_rua }}, {{ pedido.endereco_numero }}</p>
      {% if pedido.endereco_complemento %}
      <p><strong>Complemento:</strong> {{ pedido.endereco_complemento }}</p>
      {% endif %}
      <p><strong>Bairro:</strong> {{ pedido.endereco_bairro }}</p>
      <p><strong>Cidade:</strong> {{ pedido.endereco_cidade }}</p>
      <p><strong>Telefone:</strong> {{ pedido.telefone }}</p>
    </div>
    {% endif %}

    <div class="cards-admin" style="margin-top:10px;">
      <div class="cardDM">
        <h3>Status</h3>
        <form method="POST" action="/admin/pedidos/{{ pedido.id }}/status" style="display:flex;gap:10px;justify-content:center;align-items:center;">
          <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />
          <select name="status">
            {% set ops = ['Pendente','Pago','Enviado','Entregue','Cancelado'] %}
            {% for s in ops %}
              <option value="{{ s }}" {% if s == pedido.status %}selected{% endif %}>{{ s }}</option>
            {% endfor %}
          </select>
          <button class="botao-topo" type="submit">Atualizar</button>
        </form>
      </div>
      <div class="cardDM">
        <h3>Total</h3>
        <p style="font-size:22px;font-weight:800;">R$ {{ "%.2f"|format(pedido.total) }}</p>
      </div>
    </div>

    <div class="grafico-box">
      <h3>Itens do Pedido</h3>
      <table class="tabela-admin">
        <thead>
          <tr>
            <th>Produto</th>
            <th>Pre√ßo</th>
            <th>Qtd</th>
            <th>Subtotal</th>
          </tr>
        </thead>
        <tbody>
          {% for it in itens %}
          <tr>
            <td style="display:flex;align-items:center;gap:8px;">
              {% if it.imagem %}
              <img src="/static/{{ it.imagem }}" alt="" width="46" style="border-radius:6px;">
              {% endif %}
              {{ it.titulo }}
            </td>
            <td>R$ {{ "%.2f"|format(it.preco_unit) }}</td>
            <td>{{ it.quantidade }}</td>
            <td>R$ {{ "%.2f"|format(it.subtotal) }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    <div style="display:flex;gap:10px;justify-content:flex-end;margin-top:10px;">
      <a class="botao-topo" href="/admin/pedidos">‚¨Ö Voltar</a>
      <a class="botao-topo" href="/admin">Dashboard</a>
    </div>
  </div>
</section>

<style>
.endereco-entrega {
  background: #f8f9fa;
  padding: 20px;
  border-radius: 10px;
  margin: 20px 0;
  border-left: 4px solid #ff9800;
}

.endereco-entrega h3 {
  margin-top: 0;
  color: #333;
  font-size: 1.2em;
  margin-bottom: 15px;
}

.endereco-entrega p {
  margin: 8px 0;
  color: #555;
  line-height: 1.6;
}
</style>

{% endblock %}
