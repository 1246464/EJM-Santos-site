{% extends "base.html" %}
{% block content %}
<style>
/* Perfil Novo - CSS Inline */
.perfil-page { max-width: 1200px; margin: 0 auto; padding: 30px 20px; }
.perfil-header-novo { background: linear-gradient(135deg, #F6B800, #FFC107); border-radius: 12px; padding: 32px; margin-bottom: 24px; box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1); }
.perfil-header-content { display: flex; justify-content: space-between; align-items: center; }
.perfil-avatar { display: flex; align-items: center; gap: 20px; }
.avatar-circle { width: 80px; height: 80px; border-radius: 50%; background: white; display: flex; align-items: center; justify-content: center; font-size: 2rem; font-weight: 800; color: #B45309; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1); }
.perfil-info-header h1 { margin: 0; font-size: 1.8rem; font-weight: 700; color: #000; }
.perfil-info-header p { margin: 4px 0 0 0; color: rgba(0, 0, 0, 0.7); font-size: 0.95rem; }
.btn-admin-novo { display: flex; align-items: center; gap: 8px; background: white; color: #1976d2; padding: 12px 20px; border-radius: 8px; font-weight: 600; transition: all 0.3s; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1); text-decoration: none; }
.btn-admin-novo:hover { background: #e3f2fd; transform: translateY(-2px); }
.btn-carrinho-novo { display: flex; align-items: center; gap: 8px; background: white; color: #00a650; padding: 12px 20px; border-radius: 8px; font-weight: 600; transition: all 0.3s; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1); text-decoration: none; }
.btn-carrinho-novo:hover { background: #e8f5e9; transform: translateY(-2px); }
.btn-logout-novo { display: flex; align-items: center; gap: 8px; background: white; color: #d32f2f; padding: 12px 20px; border-radius: 8px; font-weight: 600; transition: all 0.3s; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1); text-decoration: none; }
.btn-logout-novo:hover { background: #fff5f5; transform: translateY(-2px); }
.perfil-tabs { display: flex; gap: 8px; background: white; border-radius: 12px; padding: 8px; margin-bottom: 24px; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06); overflow-x: auto; }
.tab-btn { display: flex; align-items: center; gap: 8px; padding: 12px 20px; border: none; background: transparent; border-radius: 8px; font-weight: 600; color: #666; cursor: pointer; transition: all 0.3s; white-space: nowrap; }
.tab-btn:hover { background: #f5f5f5; color: #222; }
.tab-btn.active { background: #F6B800; color: #000; }
.perfil-content { background: white; border-radius: 12px; padding: 32px; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06); min-height: 500px; }
.tab-content { display: none; }
.tab-content.active { display: block; animation: fadeInUp 0.4s ease; }
.content-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 28px; padding-bottom: 20px; border-bottom: 2px solid #f0f0f0; }
.content-header h2 { margin: 0; font-size: 1.6rem; font-weight: 700; color: #222; }
.stats-mini { display: flex; gap: 24px; }
.stat-mini { font-size: 0.95rem; color: #666; }
.stat-mini strong { color: #B45309; font-size: 1.1rem; }
.pedidos-grid { display: grid; gap: 20px; }
.pedido-card-novo { border: 1px solid #e0e0e0; border-radius: 12px; padding: 20px; transition: all 0.3s; }
.pedido-card-novo:hover { border-color: #F6B800; box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1); transform: translateY(-2px); }
.pedido-card-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; }
.pedido-numero { display: flex; flex-direction: column; }
.pedido-numero .label { font-size: 0.8rem; color: #666; text-transform: uppercase; }
.pedido-numero .numero { font-size: 1.2rem; font-weight: 700; color: #222; }
.pedido-badge { padding: 6px 12px; border-radius: 20px; font-size: 0.85rem; font-weight: 600; }
.badge-pendente { background: #fff3cd; color: #795548; }
.badge-pago { background: #d1f7c4; color: #1b5e20; }
.badge-enviado { background: #cfe8ff; color: #0d47a1; }
.badge-entregue { background: #e4f8e8; color: #2e7d32; }
.badge-cancelado { background: #ffe4e4; color: #b71c1c; }
.pedido-data-compra { display: flex; align-items: center; gap: 6px; font-size: 0.9rem; color: #666; margin-bottom: 16px; }
.pedido-items { margin: 16px 0; padding: 16px; background: #fafafa; border-radius: 8px; }
.pedido-item-linha { display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #eee; }
.pedido-item-linha:last-child { border-bottom: none; }
.item-nome { color: #222; font-weight: 500; }
.item-qtd { color: #666; font-size: 0.9rem; }
.pedido-item-mais { margin-top: 8px; font-size: 0.85rem; color: #B45309; font-weight: 600; }
.pedido-card-footer { display: flex; justify-content: space-between; align-items: center; margin-top: 16px; padding-top: 16px; border-top: 1px solid #e0e0e0; }
.pedido-total { display: flex; flex-direction: column; }
.pedido-total span { font-size: 0.85rem; color: #666; }
.pedido-total strong { font-size: 1.3rem; color: #B45309; }
.btn-ver-pedido { background: #F6B800; color: #000; padding: 10px 20px; border-radius: 8px; font-weight: 600; transition: all 0.3s; text-decoration: none; }
.btn-ver-pedido:hover { background: #FFC107; transform: translateY(-2px); }
.empty-state { display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 80px 20px; text-align: center; }
.empty-state h3 { margin: 20px 0 8px; font-size: 1.4rem; color: #222; }
.empty-state p { color: #666; margin-bottom: 24px; }
.btn-comprar-agora { background: linear-gradient(135deg, #F6B800, #FFC107); color: #000; padding: 14px 32px; border-radius: 8px; font-weight: 700; box-shadow: 0 4px 12px rgba(246, 184, 0, 0.3); transition: all 0.3s; text-decoration: none; display: inline-block; }
.btn-comprar-agora:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(246, 184, 0, 0.4); }
.btn-adicionar { display: flex; align-items: center; gap: 8px; background: #F6B800; color: #000; padding: 10px 16px; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; transition: all 0.3s; }
.btn-adicionar:hover { background: #FFC107; transform: translateY(-2px); }
.enderecos-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px; }
.endereco-card { border: 2px solid #e0e0e0; border-radius: 12px; padding: 20px; transition: all 0.3s; background: white; }
.endereco-card:hover { border-color: #F6B800; box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1); }
.endereco-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px; }
.endereco-tipo { background: #F6B800; color: #000; padding: 4px 12px; border-radius: 20px; font-size: 0.85rem; font-weight: 600; }
.endereco-acoes { display: flex; gap: 8px; }
.btn-icon { background: none; border: none; cursor: pointer; color: #666; padding: 6px; border-radius: 6px; transition: all 0.3s; }
.btn-icon:hover { background: #f0f0f0; color: #B45309; }
.endereco-content p { margin: 8px 0; color: #222; line-height: 1.6; }
.endereco-rua { font-weight: 600; font-size: 1rem; }
.endereco-complemento, .endereco-cidade { font-size: 0.95rem; color: #666; }
.endereco-telefone { font-size: 0.9rem; color: #B45309; font-weight: 600; }
.endereco-add { display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 180px; cursor: pointer; border-style: dashed; background: #fafafa; }
.endereco-add:hover { background: #f0f0f0; border-color: #B45309; }
.endereco-add span { margin-top: 12px; color: #666; font-weight: 600; }
.cartoes-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 20px; margin-bottom: 30px; }
.cartao-card { border: 2px solid #e0e0e0; border-radius: 12px; padding: 24px; transition: all 0.3s; background: linear-gradient(135deg, #1a1f71, #2d3a8c); color: white; min-height: 180px; display: flex; flex-direction: column; justify-content: space-between; }
.cartao-card:hover { transform: translateY(-4px); box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15); }
.cartao-bandeira { margin-bottom: 16px; }
.cartao-info p { margin: 6px 0; }
.cartao-numero { font-size: 1.1rem; font-weight: 600; letter-spacing: 2px; }
.cartao-nome { font-size: 0.85rem; font-weight: 600; text-transform: uppercase; }
.cartao-validade { font-size: 0.8rem; opacity: 0.8; }
.cartao-acoes { display: flex; justify-content: flex-end; }
.cartao-add { background: #fafafa; border-style: dashed; color: #666; align-items: center; justify-content: center; cursor: pointer; }
.cartao-add:hover { background: #f0f0f0; border-color: #B45309; }
.cartao-add span { margin-top: 12px; font-weight: 600; }
.info-seguranca { display: flex; align-items: center; gap: 12px; padding: 16px; background: #f0f9ff; border-radius: 8px; font-size: 0.9rem; color: #666; }
.dados-form { max-width: 600px; display: flex; flex-direction: column; gap: 24px; }
.form-group { display: flex; flex-direction: column; gap: 8px; position: relative; }
.form-group label { font-weight: 600; color: #222; font-size: 0.95rem; }
.form-group input { padding: 12px 16px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 1rem; transition: all 0.3s; }
.form-group input:focus { border-color: #F6B800; outline: none; }
.form-group input:read-only { background: #f5f5f5; cursor: not-allowed; }
.btn-alterar { position: absolute; right: 8px; top: 32px; background: #F6B800; color: #000; padding: 8px 16px; border: none; border-radius: 6px; font-weight: 600; cursor: pointer; font-size: 0.85rem; transition: all 0.3s; }
.btn-alterar:hover { background: #FFC107; }
@keyframes fadeInUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

/* ============================================
   üì± CSS EXCLUSIVO PARA MOBILE
============================================ */
@media (max-width: 768px) {
  /* ESTRUTURA GERAL */
  .perfil-page { padding: 15px 10px; }
  
  /* HEADER DO PERFIL */
  .perfil-header-novo { padding: 20px 15px; border-radius: 8px; margin-bottom: 15px; }
  .perfil-header-content { flex-direction: column; gap: 15px; text-align: center; }
  .perfil-avatar { flex-direction: column; gap: 12px; }
  .avatar-circle { width: 60px; height: 60px; font-size: 1.5rem; }
  .perfil-info-header h1 { font-size: 1.3rem; }
  .perfil-info-header p { font-size: 0.85rem; }
  
  /* BOT√ïES DO HEADER - Empilhados em mobile */
  .perfil-header-novo > div > div:last-child { 
    flex-direction: column; 
    width: 100%; 
    gap: 8px; 
  }
  .btn-carrinho-novo, .btn-admin-novo, .btn-logout-novo { 
    width: 100%; 
    justify-content: center; 
    padding: 12px 16px;
    font-size: 0.9rem;
  }
  
  /* TABS - Melhor clicabilidade */
  .perfil-tabs { 
    padding: 6px; 
    gap: 6px; 
    overflow-x: auto; 
    -webkit-overflow-scrolling: touch;
    scrollbar-width: thin;
  }
  .tab-btn { 
    font-size: 0.85rem; 
    padding: 14px 20px; /* Aumentado para melhor toque */
    min-width: fit-content;
    touch-action: manipulation; /* Melhor resposta ao toque */
    -webkit-tap-highlight-color: rgba(246, 184, 0, 0.3); /* Feedback visual */
  }
  .tab-btn svg {
    width: 18px;
    height: 18px;
  }
  
  /* CONTE√öDO */
  .perfil-content { padding: 16px; min-height: auto; border-radius: 8px; }
  
  /* HEADER DO CONTE√öDO */
  .content-header { 
    flex-direction: column; 
    align-items: flex-start; 
    gap: 12px; 
    padding-bottom: 15px; 
  }
  .content-header h2 { font-size: 1.3rem; }
  .stats-mini { flex-direction: column; gap: 8px; }
  
  /* PEDIDOS */
  .pedido-card-novo { padding: 15px; }
  .pedido-card-header { flex-wrap: wrap; gap: 8px; }
  .pedido-numero .numero { font-size: 1.1rem; }
  .pedido-badge { font-size: 0.75rem; padding: 4px 10px; }
  .pedido-items { padding: 12px; }
  .pedido-card-footer { flex-direction: column; gap: 12px; align-items: flex-start; }
  .btn-ver-pedido { width: 100%; text-align: center; padding: 12px; }
  
  /* ENDERE√áOS E CART√ïES */
  .enderecos-grid, .cartoes-grid { grid-template-columns: 1fr; }
  .endereco-card, .cartao-card { padding: 16px; }
  
  /* BOT√ïES DE A√á√ÉO */
  .btn-adicionar { width: 100%; justify-content: center; padding: 12px; }
  .btn-comprar-agora { width: 100%; text-align: center; padding: 12px 24px; }
  
  /* FORMUL√ÅRIOS */
  .dados-form { width: 100%; }
  .form-group input { font-size: 16px; /* Evita zoom no iOS */ }
  .btn-alterar { position: static; width: 100%; margin-top: 8px; padding: 10px; }
  
  /* ESTADO VAZIO */
  .empty-state { padding: 40px 15px; }
  .empty-state h3 { font-size: 1.2rem; }
  .empty-state svg { width: 60px; height: 60px; }
}
</style>
<div class="perfil-page">
  
  <!-- Header do Perfil -->
  <div class="perfil-header-novo">
    <div class="perfil-header-content">
      <div class="perfil-avatar">
        <div class="avatar-circle">
          {{ session['user_name'][0].upper() }}
        </div>
        <div class="perfil-info-header">
          <h1>{{ session['user_name'] }}</h1>
          <p>{{ user.email if user else 'N/A' }}</p>
        </div>
      </div>
      <div style="display: flex; gap: 12px; align-items: center;">
        <a href="/carrinho" class="btn-carrinho-novo">
          <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
            <path d="M0 0v2h2l3.6 7.6L4.2 12c-.1.3-.2.6-.2 1 0 1.1.9 2 2 2h12v-2H6.4c-.1 0-.2-.1-.2-.2l.1-.2 1-1.8h7.5c.7 0 1.4-.4 1.7-1l3.6-6.6c.1-.1.1-.3.1-.4 0-.6-.4-1-1-1H4.2L3.3 0H0zm16 16c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zM6 16c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"/>
          </svg>
          Carrinho
        </a>
        {% if session.get('is_admin') %}
        <a href="/admin" class="btn-admin-novo">
          <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
            <path d="M10 0L0 5v5c0 7.5 4.4 11.5 10 13 5.6-1.5 10-5.5 10-13V5L10 0zm0 18c-4-1-8-4-8-10V7l8-4 8 4v3c0 6-4 9-8 10z"/>
          </svg>
          Painel Admin
        </a>
        {% endif %}
        <a href="/logout" class="btn-logout-novo">
        <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
          <path d="M10 0C4.5 0 0 4.5 0 10s4.5 10 10 10 10-4.5 10-10S15.5 0 10 0zm4 13l-1.5 1.5L8 10l4.5-4.5L14 7l-3 3 3 3z"/>
        </svg>
        Sair
      </a>
    </div>
  </div>

  <!-- Navega√ß√£o por Abas -->
  <div class="perfil-tabs">
    <button class="tab-btn active" onclick="showTab('pedidos')">
      <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
        <path d="M3 1h14a2 2 0 012 2v14a2 2 0 01-2 2H3a2 2 0 01-2-2V3a2 2 0 012-2z"/>
      </svg>
      Meus Pedidos
    </button>
    <button class="tab-btn" onclick="showTab('enderecos')">
      <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
        <path d="M10 0C6.5 0 3.5 3 3.5 6.5c0 5.25 6.5 13.5 6.5 13.5s6.5-8.25 6.5-13.5C16.5 3 13.5 0 10 0zm0 9a2.5 2.5 0 110-5 2.5 2.5 0 010 5z"/>
      </svg>
      Endere√ßos
    </button>
    <button class="tab-btn" onclick="showTab('pagamento')">
      <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
        <path d="M18 4H2a2 2 0 00-2 2v8a2 2 0 002 2h16a2 2 0 002-2V6a2 2 0 00-2-2zM2 8h16v2H2V8z"/>
      </svg>
      Formas de Pagamento
    </button>
    <button class="tab-btn" onclick="showTab('dados')">
      <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
        <path d="M10 0a10 10 0 100 20 10 10 0 000-20zm0 5a3 3 0 110 6 3 3 0 010-6zm0 13c-2.5 0-4.7-1.3-6-3.3.3-2 4-3.1 6-3.1s5.7 1.1 6 3.1c-1.3 2-3.5 3.3-6 3.3z"/>
      </svg>
      Meus Dados
    </button>
  </div>

  <!-- Conte√∫do das Abas -->
  <div class="perfil-content">
    
    <!-- Aba: Meus Pedidos -->
    <div id="tab-pedidos" class="tab-content active">
      <div class="content-header">
        <h2>Hist√≥rico de Pedidos</h2>
        <div class="stats-mini">
          <span class="stat-mini">
            <strong>{{ pedidos|length }}</strong> pedidos
          </span>
        </div>
      </div>

      {% if pedidos %}
      <div class="pedidos-grid">
        {% for pedido in pedidos %}
        <div class="pedido-card-novo">
          <div class="pedido-card-header">
            <div class="pedido-numero">
              <span class="label">Pedido</span>
              <span class="numero">#{{ pedido.id }}</span>
            </div>
            <span class="pedido-badge badge-{{ pedido.status.lower().replace(' ', '-') }}">
              {{ pedido.status }}
            </span>
          </div>

          <div class="pedido-data-compra">
            <svg width="14" height="14" viewBox="0 0 14 14" fill="currentColor">
              <path d="M7 0a7 7 0 100 14A7 7 0 007 0zm0 12a5 5 0 110-10 5 5 0 010 10zm.5-8H6v4l3.5 2 .5-.8-2.5-1.5V4z"/>
            </svg>
            {{ pedido.created_at.strftime('%d/%m/%Y √†s %H:%M') }}
          </div>

          <div class="pedido-items">
            {% for item in pedido.items[:2] %}
            <div class="pedido-item-linha">
              <span class="item-nome">{{ item.product.titulo }}</span>
              <span class="item-qtd">x{{ item.quantidade }}</span>
            </div>
            {% endfor %}
            {% if pedido.items|length > 2 %}
            <div class="pedido-item-mais">+ {{ pedido.items|length - 2 }} item(s)</div>
            {% endif %}
          </div>

          <div class="pedido-card-footer">
            <div class="pedido-total">
              <span>Total</span>
              <strong>R$ {{ "%.2f"|format(pedido.total) }}</strong>
            </div>
            <a href="/pedido/{{ pedido.id }}" class="btn-ver-pedido">Ver detalhes</a>
          </div>
        </div>
        {% endfor %}
      </div>
      {% else %}
      <div class="empty-state">
        <svg width="80" height="80" viewBox="0 0 80 80" fill="none">
          <circle cx="40" cy="40" r="40" fill="#F5F5F5"/>
          <path d="M25 30h30l-3 25H28l-3-25z" stroke="#CCC" stroke-width="3" fill="none"/>
        </svg>
        <h3>Nenhum pedido ainda</h3>
        <p>Quando voc√™ fizer compras, elas aparecer√£o aqui</p>
        <a href="/produtos" class="btn-comprar-agora">Come√ßar a comprar</a>
      </div>
      {% endif %}
    </div>

    <!-- Aba: Endere√ßos -->
    <div id="tab-enderecos" class="tab-content">
      <div class="content-header">
        <h2>Meus Endere√ßos</h2>
        <button class="btn-adicionar" onclick="irParaCheckout()">
          <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
            <path d="M8 0v16M0 8h16" stroke="currentColor" stroke-width="2"/>
          </svg>
          Adicionar no pr√≥ximo pedido
        </button>
      </div>

      <div class="enderecos-grid">
        {% if enderecos %}
          {% for endereco in enderecos %}
          <div class="endereco-card">
            <div class="endereco-header">
              <span class="endereco-tipo">{{ endereco.apelido }}{% if endereco.is_default %} (Padr√£o){% endif %}</span>
              <div class="endereco-acoes">
                <button class="btn-icon" onclick="editarEndereco({{ endereco.id }})" title="Editar">
                  <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                    <path d="M12 0l4 4-8 8H4v-4l8-8zm0 3l-1 1-1-1 1-1 1 1z"/>
                  </svg>
                </button>
                <button class="btn-icon" onclick="removerEndereco({{ endereco.id }})" title="Remover">
                  <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                    <path d="M3 4h10v1H3V4zm1 2h8v7a1 1 0 01-1 1H5a1 1 0 01-1-1V6z"/>
                  </svg>
                </button>
              </div>
            </div>
            <div class="endereco-content">
              <p class="endereco-rua">{{ endereco.rua }}, {{ endereco.numero }}</p>
              {% if endereco.complemento %}
              <p class="endereco-complemento">{{ endereco.complemento }}</p>
              {% endif %}
              <p class="endereco-cidade">{{ endereco.bairro }}, {{ endereco.cidade }}{% if endereco.estado %} - {{ endereco.estado }}{% endif %}</p>
              {% if endereco.cep %}
              <p class="endereco-complemento">CEP: {{ endereco.cep }}</p>
              {% endif %}
              <p class="endereco-telefone">üìû {{ endereco.telefone }}</p>
            </div>
          </div>
          {% endfor %}
        {% else %}
        <div class="empty-state">
          <h3>üòä Nenhum endere√ßo salvo ainda</h3>
          <p>Adicione endere√ßos durante o checkout para facilitar suas pr√≥ximas compras</p>
          <a href="/produtos" class="btn-comprar-agora">Ver Produtos</a>
        </div>
        {% endif %}
      </div>
    </div>

    <!-- Aba: Formas de Pagamento -->
    <div id="tab-pagamento" class="tab-content">
      <div class="content-header">
        <h2>Formas de Pagamento</h2>
        <button class="btn-adicionar" onclick="irParaCheckout()">
          <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
            <path d="M8 0v16M0 8h16" stroke="currentColor" stroke-width="2"/>
          </svg>
          Adicionar no pr√≥ximo pedido
        </button>
      </div>

      <div class="cartoes-grid">
        {% if cartoes %}
          {% for cartao in cartoes %}
          <div class="cartao-card">
            <div class="cartao-bandeira">
              <div style="font-size: 0.8rem; font-weight: 600; opacity: 0.8;">
                {{ cartao.apelido }}{% if cartao.is_default %} (Padr√£o){% endif %}
              </div>
            </div>
            <div class="cartao-info">
              <p class="cartao-numero">{{ cartao.get_card_display() }}</p>
              <p class="cartao-nome">{{ session['user_name'].upper() }}</p>
              <p class="cartao-validade">
                V√°lido at√© {{ "%02d"|format(cartao.card_exp_month) }}/{{ cartao.card_exp_year }}
                {% if cartao.is_expired() %}<br><span style="color: #ff6b6b; font-weight: 600;">‚ö†Ô∏è Expirado</span>{% endif %}
              </p>
            </div>
            <div class="cartao-acoes">
              <button class="btn-icon" style="color: white;" onclick="removerCartao({{ cartao.id }})" title="Remover">
                <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                  <path d="M3 4h10v1H3V4zm1 2h8v7a1 1 0 01-1 1H5a1 1 0 01-1-1V6z"/>
                </svg>
              </button>
            </div>
          </div>
          {% endfor %}
        {% else %}
        <div class="empty-state">
          <h3>üòä Nenhum cart√£o salvo ainda</h3>
          <p>Salve seus cart√µes durante o checkout para pagamentos mais r√°pidos</p>
          <a href="/produtos" class="btn-comprar-agora">Ver Produtos</a>
        </div>
        {% endif %}
      </div>

      <div class="info-seguranca">
        <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor" style="color: #00a650;">
          <path d="M8 0L2 3v5c0 3.5 2.4 6.8 6 7.7 3.6-.9 6-4.2 6-7.7V3L8 0zm0 11H7V7h1v4zm0-5H7V4h1v2z"/>
        </svg>
        <p>Seus dados de pagamento s√£o criptografados e armazenados com seguran√ßa via Stripe</p>
      </div>
    </div>

    <!-- Aba: Meus Dados -->
    <div id="tab-dados" class="tab-content">
      <div class="content-header">
        <h2>Informa√ß√µes Pessoais</h2>
      </div>

      <div class="dados-form">
        <div class="form-group">
          <label>Nome completo</label>
          <input type="text" value="{{ session['user_name'] }}" readonly>
        </div>
        <div class="form-group">
          <label>Email</label>
          <input type="email" value="{{ user.email if user else 'N/A' }}" readonly>
        </div>
        <div class="form-group">
          <label>Senha</label>
          <input type="password" value="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" readonly>
          <button class="btn-alterar">Alterar senha</button>
        </div>
        <div class="form-group">
          <label>Membro desde</label>
          <input type="text" value="{{ user.created_at.strftime('%d/%m/%Y') if user else 'N/A' }}" readonly>
        </div>
      </div>
    </div>

  </div>
</div>

<!-- Modal de Endere√ßo -->
<div id="modal-endereco" class="modal-overlay" style="display: none;">
  <div class="modal-content">
    <div class="modal-header">
      <h3>Adicionar Endere√ßo</h3>
      <button onclick="fecharModal('modal-endereco')" class="btn-fechar-modal">&times;</button>
    </div>
    <form id="form-endereco" class="modal-form">
      <div class="form-row">
        <div class="form-group-modal">
          <label>CEP *</label>
          <input type="text" name="cep" placeholder="00000-000" required maxlength="9">
        </div>
        <div class="form-group-modal">
          <label>Rua *</label>
          <input type="text" name="rua" placeholder="Nome da rua" required>
        </div>
      </div>
      <div class="form-row">
        <div class="form-group-modal" style="flex: 0 0 30%;">
          <label>N√∫mero *</label>
          <input type="text" name="numero" placeholder="123" required>
        </div>
        <div class="form-group-modal">
          <label>Complemento</label>
          <input type="text" name="complemento" placeholder="Apto, bloco...">
        </div>
      </div>
      <div class="form-row">
        <div class="form-group-modal">
          <label>Bairro *</label>
          <input type="text" name="bairro" placeholder="Nome do bairro" required>
        </div>
        <div class="form-group-modal">
          <label>Cidade *</label>
          <input type="text" name="cidade" placeholder="Nome da cidade" required>
        </div>
      </div>
      <div class="form-group-modal">
        <label>Telefone *</label>
        <input type="tel" name="telefone" placeholder="(00) 00000-0000" required>
      </div>
      <div class="modal-footer">
        <button type="button" onclick="fecharModal('modal-endereco')" class="btn-cancelar">Cancelar</button>
        <button type="submit" class="btn-salvar">Salvar Endere√ßo</button>
      </div>
    </form>
  </div>
</div>

<!-- Modal de Alterar Senha -->
<div id="modal-senha" class="modal-overlay" style="display: none;">
  <div class="modal-content">
    <div class="modal-header">
      <h3>Alterar Senha</h3>
      <button onclick="fecharModal('modal-senha')" class="btn-fechar-modal">&times;</button>
    </div>
    <form id="form-senha" class="modal-form">
      <div class="form-group-modal">
        <label>Senha Atual *</label>
        <input type="password" name="senha_atual" placeholder="Digite sua senha atual" required>
      </div>
      <div class="form-group-modal">
        <label>Nova Senha *</label>
        <input type="password" name="nova_senha" placeholder="Digite a nova senha" required minlength="6">
      </div>
      <div class="form-group-modal">
        <label>Confirmar Nova Senha *</label>
        <input type="password" name="confirmar_senha" placeholder="Confirme a nova senha" required minlength="6">
      </div>
      <div class="modal-footer">
        <button type="button" onclick="fecharModal('modal-senha')" class="btn-cancelar">Cancelar</button>
        <button type="submit" class="btn-salvar">Alterar Senha</button>
      </div>
    </form>
  </div>
</div>

<style>
/* Modais */
.modal-overlay {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0, 0, 0, 0.7);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 9999;
  padding: 20px;
}

.modal-content {
  background: white;
  border-radius: 16px;
  width: 100%;
  max-width: 600px;
  max-height: 90vh;
  overflow-y: auto;
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
  animation: modalSlideIn 0.3s ease;
}

@keyframes modalSlideIn {
  from {
    opacity: 0;
    transform: translateY(-50px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.modal-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 24px 28px;
  border-bottom: 2px solid #f0f0f0;
}

.modal-header h3 {
  margin: 0;
  font-size: 1.5rem;
  color: #222;
}

.btn-fechar-modal {
  background: none;
  border: none;
  font-size: 2rem;
  color: #666;
  cursor: pointer;
  line-height: 1;
  padding: 0;
  width: 32px;
  height: 32px;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: 50%;
  transition: all 0.3s;
}

.btn-fechar-modal:hover {
  background: #f0f0f0;
  color: #d32f2f;
}

.modal-form {
  padding: 28px;
}

.form-row {
  display: flex;
  gap: 16px;
}

.form-group-modal {
  flex: 1;
  display: flex;
  flex-direction: column;
  gap: 8px;
  margin-bottom: 20px;
}

.form-group-modal label {
  font-weight: 600;
  color: #222;
  font-size: 0.95rem;
}

.form-group-modal input,
.form-group-modal select,
.form-group-modal textarea {
  padding: 12px 16px;
  border: 2px solid #e0e0e0;
  border-radius: 8px;
  font-size: 1rem;
  transition: all 0.3s;
  font-family: inherit;
}

.form-group-modal input:focus,
.form-group-modal select:focus,
.form-group-modal textarea:focus {
  border-color: #F6B800;
  outline: none;
  box-shadow: 0 0 0 3px rgba(246, 184, 0, 0.1);
}

.modal-footer {
  display: flex;
  gap: 12px;
  justify-content: flex-end;
  padding-top: 20px;
  border-top: 1px solid #f0f0f0;
  margin-top: 10px;
}

.btn-cancelar {
  padding: 12px 24px;
  border: 2px solid #e0e0e0;
  background: white;
  color: #666;
  border-radius: 8px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s;
}

.btn-cancelar:hover {
  background: #f5f5f5;
  border-color: #ccc;
}

.btn-salvar {
  padding: 12px 24px;
  border: none;
  background: #F6B800;
  color: #000;
  border-radius: 8px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s;
}

.btn-salvar:hover {
  background: #FFC107;
  transform: translateY(-2px);
}

@media (max-width: 768px) {
  .form-row {
    flex-direction: column;
  }
}
</style>

<script>
function showTab(tabName) {
  // Remove active de todos os bot√µes e conte√∫dos
  document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
  document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
  
  // Adiciona active no bot√£o e conte√∫do selecionado
  event.target.closest('.tab-btn').classList.add('active');
  document.getElementById('tab-' + tabName).classList.add('active');
}

function abrirModalEndereco() {
  document.getElementById('modal-endereco').style.display = 'flex';
}

function abrirModalCartao() {
  alert('Funcionalidade de adicionar cart√£o em desenvolvimento\n\nPara seguran√ßa, cart√µes devem ser gerenciados diretamente no checkout.');
}

function fecharModal(modalId) {
  document.getElementById(modalId).style.display = 'none';
}

// Fechar modal ao clicar fora
document.querySelectorAll('.modal-overlay').forEach(modal => {
  modal.addEventListener('click', function(e) {
    if (e.target === this) {
      this.style.display = 'none';
    }
  });
});

// Form de Endere√ßo
document.getElementById('form-endereco').addEventListener('submit', async function(e) {
  e.preventDefault();
  const formData = new FormData(this);
  const data = Object.fromEntries(formData);
  
  // Simula√ß√£o - voc√™ pode implementar a rota no backend
  console.log('Salvando endere√ßo:', data);
  alert('‚úÖ Endere√ßo salvo com sucesso!\n\n(Funcionalidade de backend em desenvolvimento)');
  fecharModal('modal-endereco');
  this.reset();
});

// Form de Alterar Senha
document.getElementById('form-senha').addEventListener('submit', async function(e) {
  e.preventDefault();
  const formData = new FormData(this);
  const data = Object.fromEntries(formData);
  
  if (data.nova_senha !== data.confirmar_senha) {
    alert('‚ùå As senhas n√£o coincidem!');
    return;
  }
  
  // Simula√ß√£o - voc√™ pode implementar a rota no backend
  console.log('Alterando senha');
  alert('‚úÖ Senha alterada com sucesso!\n\n(Funcionalidade de backend em desenvolvimento)');
  fecharModal('modal-senha');
  this.reset();
});

// Bot√£o alterar senha
document.querySelector('.btn-alterar').addEventListener('click', function() {
  document.getElementById('modal-senha').style.display = 'flex';
});

// M√°scara de CEP
document.querySelector('input[name="cep"]').addEventListener('input', function(e) {
  let value = e.target.value.replace(/\D/g, '');
  if (value.length > 5) {
    value = value.slice(0, 5) + '-' + value.slice(5, 8);
  }
  e.target.value = value;
});

// M√°scara de Telefone
document.querySelector('input[name="telefone"]').addEventListener('input', function(e) {
  let value = e.target.value.replace(/\D/g, '');
  if (value.length > 10) {
    value = '(' + value.slice(0, 2) + ') ' + value.slice(2, 7) + '-' + value.slice(7, 11);
  } else if (value.length > 6) {
    value = '(' + value.slice(0, 2) + ') ' + value.slice(2, 6) + '-' + value.slice(6);
  } else if (value.length > 2) {
    value = '(' + value.slice(0, 2) + ') ' + value.slice(2);
  }
  e.target.value = value;
});

// Fun√ß√µes para gerenciar endere√ßos e cart√µes
function irParaCheckout() {
  window.location.href = '/carrinho';
}

function removerEndereco(id) {
  if (!confirm('Deseja remover este endere√ßo?')) return;
  
  fetch(`/api/addresses/${id}`, {
    method: 'DELETE',
    headers: {'Content-Type':'application/json'}
  })
  .then(r => r.json())
  .then(data => {
    if (data.error) {
      alert('‚ùå Erro ao remover endere√ßo: ' + data.error);
    } else {
      alert('‚úÖ Endere√ßo removido com sucesso!');
      location.reload();
    }
  })
  .catch(err => {
    alert('‚ùå Erro: ' + err.message);
  });
}

function removerCartao(id) {
  if (!confirm('Deseja remover este cart√£o? Esta a√ß√£o n√£o pode ser desfeita.')) return;
  
  fetch(`/api/payment-methods/${id}`, {
    method: 'DELETE',
    headers: {'Content-Type':'application/json'}
  })
  .then(r => r.json())
  .then(data => {
    if (data.error) {
      alert('‚ùå Erro ao remover cart√£o: ' + data.error);
    } else {
      alert('‚úÖ Cart√£o removido com sucesso!');
      location.reload();
    }
  })
  .catch(err => {
    alert('‚ùå Erro: ' + err.message);
  });
}

function editarEndereco(id) {
  alert('üí° Para editar, remova este endere√ßo e adicione um novo durante o pr√≥ximo checkout.');
}
</script>
{% endblock %}
